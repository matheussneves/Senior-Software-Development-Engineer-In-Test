"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.COMMAND_TYPES = exports.AndroidBootstrap = void 0;

require("source-map-support/register");

var _uiautomator = _interopRequireDefault(require("./uiautomator"));

var _net = _interopRequireDefault(require("net"));

var _path = _interopRequireDefault(require("path"));

var _lodash = _interopRequireDefault(require("lodash"));

var _driver = require("appium/driver");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _support = require("appium/support");

const log = _support.logger.getLogger('AndroidBootstrap');

const COMMAND_TYPES = {
  ACTION: 'action',
  SHUTDOWN: 'shutdown'
};
exports.COMMAND_TYPES = COMMAND_TYPES;
const SEND_COMMAND_TIMEOUT = 1 * 60 * 1000;

class AndroidBootstrap {
  constructor(adb, systemPort = 4724, webSocket = undefined) {
    this.adb = adb;
    this.systemPort = systemPort;
    this.webSocket = webSocket;
    this.ignoreUnexpectedShutdown = false;
  }

  get onUnexpectedShutdown() {
    if (!this._onUnexpectedShutdownPromise) {
      let reject;
      this._onUnexpectedShutdownPromise = new _bluebird.default(function _onUnexpectedShutdownPromise(_resolve, _reject) {
        reject = _reject;
      });
      this._onUnexpectedShutdownPromise.cancel = reject;
    }

    return this._onUnexpectedShutdownPromise;
  }

  async start(appPackage, disableAndroidWatchers = false, acceptSslCerts = false) {
    try {
      const rootDir = _path.default.resolve(__dirname, '..', '..');

      const startDetector = s => /Appium Socket Server Ready/.test(s);

      const bootstrapJar = _path.default.resolve(rootDir, 'bootstrap', 'bin', 'AppiumBootstrap.jar');

      await this.init();
      await this.adb.forwardPort(this.systemPort, 4724);
      this.process = await this.uiAutomator.start(bootstrapJar, 'io.appium.android.bootstrap.Bootstrap', startDetector, '-e', 'pkg', appPackage, '-e', 'disableAndroidWatchers', disableAndroidWatchers, '-e', 'acceptSslCerts', acceptSslCerts);
      this.process.on('output', (stdout, stderr) => {
        const alertRe = /Emitting system alert message/;

        if (alertRe.test(stdout)) {
          log.debug('Emitting alert message...');

          if (this.webSocket) {
            this.webSocket.sockets.emit('alert', {
              message: stdout
            });
          }
        }

        let stdoutLines = (stdout || '').split('\n');
        const uiautoLog = /\[APPIUM-UIAUTO\](.+)\[\/APPIUM-UIAUTO\]/;

        for (let line of stdoutLines) {
          if (line.trim()) {
            if (uiautoLog.test(line)) {
              let innerLine = uiautoLog.exec(line)[1].trim();
              let logMethod = log.info.bind(log);

              if (/\[debug\]/.test(innerLine)) {
                logMethod = log.debug.bind(log);
              }

              logMethod(`[BOOTSTRAP LOG] ${innerLine}`);
            } else {
              log.debug(`[UIAUTO STDOUT] ${line}`);
            }
          }
        }

        let stderrLines = (stderr || '').split('\n');

        for (let line of stderrLines) {
          if (line.trim()) {
            log.debug(`[UIAUTO STDERR] ${line}`);
          }
        }
      });
      return await new _bluebird.default((resolve, reject) => {
        try {
          this.socketClient = _net.default.connect(this.systemPort);
          this.socketClient.on('error', err => {
            if (!this.ignoreUnexpectedShutdown) {
              throw new Error(`Android bootstrap socket crashed: ${err}`);
            }
          });
          this.socketClient.once('connect', () => {
            log.info('Android bootstrap socket is now connected');
            resolve();
          });
        } catch (err) {
          reject(err);
        }
      });
    } catch (err) {
      log.errorAndThrow(`Error occured while starting AndroidBootstrap. Original error: ${err}`);
    }
  }

  async sendCommand(type, extra = {}) {
    if (!this.socketClient) {
      throw new Error('Socket connection closed unexpectedly');
    }

    return await new _bluebird.default((resolve, reject) => {
      let cmd = Object.assign({
        cmd: type
      }, extra);
      let cmdJson = `${JSON.stringify(cmd)} \n`;
      log.debug(`Sending command to android: ${_lodash.default.truncate(cmdJson, {
        length: 1000
      }).trim()}`);
      this.socketClient.write(cmdJson);
      this.socketClient.setEncoding('utf8');
      let streamData = '';
      let sendCommandTimeoutHandler = null;
      this.socketClient.on('data', data => {
        if (sendCommandTimeoutHandler) {
          clearTimeout(sendCommandTimeoutHandler);
        }

        log.debug('Received command result from bootstrap');

        try {
          streamData = JSON.parse(streamData + data);
          this.socketClient.removeAllListeners('data');

          if (streamData.status === 0) {
            return resolve(streamData.value);
          }

          reject((0, _driver.errorFromCode)(streamData.status, streamData.value));
        } catch (err) {
          if (!_lodash.default.isString(streamData)) {
            log.error('Got an unexpected error inside socket listener');
            log.error(err.stack);
            return reject((0, _driver.errorFromCode)(13, err.message));
          }

          log.debug(`Stream still not complete, waiting up to ${SEND_COMMAND_TIMEOUT}ms for the data to arrive`);
          streamData += data;
          sendCommandTimeoutHandler = setTimeout(() => {
            const errMsg = `Server socket stopped responding. The recent response was '${streamData}'`;
            log.error(errMsg);
            this.socketClient.removeAllListeners('data');
            reject((0, _driver.errorFromCode)(13, errMsg));
          }, SEND_COMMAND_TIMEOUT);
        }
      });
    });
  }

  async sendAction(action, params = {}) {
    let extra = {
      action,
      params
    };
    return await this.sendCommand(COMMAND_TYPES.ACTION, extra);
  }

  async shutdown() {
    if (!this.uiAutomator) {
      log.warn('Cannot shut down Android bootstrap; it has already shut down');
      return;
    }

    this.uiAutomator.removeAllListeners(_uiautomator.default.EVENT_CHANGED);

    if (this.socketClient) {
      await this.sendCommand(COMMAND_TYPES.SHUTDOWN);
    }

    await this.uiAutomator.shutdown();
    this.uiAutomator = null;
  }

  async init() {
    this.uiAutomator = new _uiautomator.default(this.adb);
    this.uiAutomator.on(_uiautomator.default.EVENT_CHANGED, msg => {
      if (msg.state === _uiautomator.default.STATE_STOPPED) {
        this.uiAutomator = null;
        this.onUnexpectedShutdown.cancel(new Error('UiAUtomator shut down unexpectedly'));
      }
    });
  }

  set ignoreUnexpectedShutdown(ignore) {
    log.debug(`${ignore ? 'Ignoring' : 'Watching for'} bootstrap disconnect`);
    this._ignoreUnexpectedShutdown = ignore;
  }

  get ignoreUnexpectedShutdown() {
    return this._ignoreUnexpectedShutdown;
  }

}

exports.AndroidBootstrap = AndroidBootstrap;
var _default = AndroidBootstrap;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL2Jvb3RzdHJhcC5qcyIsIm5hbWVzIjpbImxvZyIsImxvZ2dlciIsImdldExvZ2dlciIsIkNPTU1BTkRfVFlQRVMiLCJBQ1RJT04iLCJTSFVURE9XTiIsIlNFTkRfQ09NTUFORF9USU1FT1VUIiwiQW5kcm9pZEJvb3RzdHJhcCIsImNvbnN0cnVjdG9yIiwiYWRiIiwic3lzdGVtUG9ydCIsIndlYlNvY2tldCIsInVuZGVmaW5lZCIsImlnbm9yZVVuZXhwZWN0ZWRTaHV0ZG93biIsIm9uVW5leHBlY3RlZFNodXRkb3duIiwiX29uVW5leHBlY3RlZFNodXRkb3duUHJvbWlzZSIsInJlamVjdCIsIkIiLCJfcmVzb2x2ZSIsIl9yZWplY3QiLCJjYW5jZWwiLCJzdGFydCIsImFwcFBhY2thZ2UiLCJkaXNhYmxlQW5kcm9pZFdhdGNoZXJzIiwiYWNjZXB0U3NsQ2VydHMiLCJyb290RGlyIiwicGF0aCIsInJlc29sdmUiLCJfX2Rpcm5hbWUiLCJzdGFydERldGVjdG9yIiwicyIsInRlc3QiLCJib290c3RyYXBKYXIiLCJpbml0IiwiZm9yd2FyZFBvcnQiLCJwcm9jZXNzIiwidWlBdXRvbWF0b3IiLCJvbiIsInN0ZG91dCIsInN0ZGVyciIsImFsZXJ0UmUiLCJkZWJ1ZyIsInNvY2tldHMiLCJlbWl0IiwibWVzc2FnZSIsInN0ZG91dExpbmVzIiwic3BsaXQiLCJ1aWF1dG9Mb2ciLCJsaW5lIiwidHJpbSIsImlubmVyTGluZSIsImV4ZWMiLCJsb2dNZXRob2QiLCJpbmZvIiwiYmluZCIsInN0ZGVyckxpbmVzIiwic29ja2V0Q2xpZW50IiwibmV0IiwiY29ubmVjdCIsImVyciIsIkVycm9yIiwib25jZSIsImVycm9yQW5kVGhyb3ciLCJzZW5kQ29tbWFuZCIsInR5cGUiLCJleHRyYSIsImNtZCIsIk9iamVjdCIsImFzc2lnbiIsImNtZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiXyIsInRydW5jYXRlIiwibGVuZ3RoIiwid3JpdGUiLCJzZXRFbmNvZGluZyIsInN0cmVhbURhdGEiLCJzZW5kQ29tbWFuZFRpbWVvdXRIYW5kbGVyIiwiZGF0YSIsImNsZWFyVGltZW91dCIsInBhcnNlIiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwic3RhdHVzIiwidmFsdWUiLCJlcnJvckZyb21Db2RlIiwiaXNTdHJpbmciLCJlcnJvciIsInN0YWNrIiwic2V0VGltZW91dCIsImVyck1zZyIsInNlbmRBY3Rpb24iLCJhY3Rpb24iLCJwYXJhbXMiLCJzaHV0ZG93biIsIndhcm4iLCJVaUF1dG9tYXRvciIsIkVWRU5UX0NIQU5HRUQiLCJtc2ciLCJzdGF0ZSIsIlNUQVRFX1NUT1BQRUQiLCJpZ25vcmUiLCJfaWdub3JlVW5leHBlY3RlZFNodXRkb3duIl0sInNvdXJjZVJvb3QiOiIuLi8uLiIsInNvdXJjZXMiOlsibGliL2Jvb3RzdHJhcC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVWlBdXRvbWF0b3IgZnJvbSAnLi91aWF1dG9tYXRvcic7XG5pbXBvcnQgbmV0IGZyb20gJ25ldCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBlcnJvckZyb21Db2RlIH0gZnJvbSAnYXBwaXVtL2RyaXZlcic7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdhcHBpdW0vc3VwcG9ydCc7XG5cblxuY29uc3QgbG9nID0gbG9nZ2VyLmdldExvZ2dlcignQW5kcm9pZEJvb3RzdHJhcCcpO1xuY29uc3QgQ09NTUFORF9UWVBFUyA9IHtcbiAgQUNUSU9OOiAnYWN0aW9uJyxcbiAgU0hVVERPV046ICdzaHV0ZG93bidcbn07XG5jb25zdCBTRU5EX0NPTU1BTkRfVElNRU9VVCA9IDEgKiA2MCAqIDEwMDA7XG5cbmNsYXNzIEFuZHJvaWRCb290c3RyYXAge1xuICBjb25zdHJ1Y3RvciAoYWRiLCBzeXN0ZW1Qb3J0ID0gNDcyNCwgd2ViU29ja2V0ID0gdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5hZGIgPSBhZGI7XG4gICAgdGhpcy5zeXN0ZW1Qb3J0ID0gc3lzdGVtUG9ydDtcbiAgICB0aGlzLndlYlNvY2tldCA9IHdlYlNvY2tldDtcbiAgICB0aGlzLmlnbm9yZVVuZXhwZWN0ZWRTaHV0ZG93biA9IGZhbHNlO1xuICB9XG5cbiAgZ2V0IG9uVW5leHBlY3RlZFNodXRkb3duICgpIHtcbiAgICBpZiAoIXRoaXMuX29uVW5leHBlY3RlZFNodXRkb3duUHJvbWlzZSkge1xuICAgICAgbGV0IHJlamVjdDtcbiAgICAgIHRoaXMuX29uVW5leHBlY3RlZFNodXRkb3duUHJvbWlzZSA9IG5ldyBCKGZ1bmN0aW9uIF9vblVuZXhwZWN0ZWRTaHV0ZG93blByb21pc2UgKF9yZXNvbHZlLCBfcmVqZWN0KSB7XG4gICAgICAgIHJlamVjdCA9IF9yZWplY3Q7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuX29uVW5leHBlY3RlZFNodXRkb3duUHJvbWlzZS5jYW5jZWwgPSByZWplY3Q7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9vblVuZXhwZWN0ZWRTaHV0ZG93blByb21pc2U7XG4gIH1cblxuICBhc3luYyBzdGFydCAoYXBwUGFja2FnZSwgZGlzYWJsZUFuZHJvaWRXYXRjaGVycyA9IGZhbHNlLCBhY2NlcHRTc2xDZXJ0cyA9IGZhbHNlKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJvb3REaXIgPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4nLCAnLi4nKTtcbiAgICAgIGNvbnN0IHN0YXJ0RGV0ZWN0b3IgPSAocykgPT4gL0FwcGl1bSBTb2NrZXQgU2VydmVyIFJlYWR5Ly50ZXN0KHMpO1xuICAgICAgY29uc3QgYm9vdHN0cmFwSmFyID0gcGF0aC5yZXNvbHZlKHJvb3REaXIsICdib290c3RyYXAnLCAnYmluJywgJ0FwcGl1bUJvb3RzdHJhcC5qYXInKTtcblxuICAgICAgYXdhaXQgdGhpcy5pbml0KCk7XG4gICAgICBhd2FpdCB0aGlzLmFkYi5mb3J3YXJkUG9ydCh0aGlzLnN5c3RlbVBvcnQsIDQ3MjQpO1xuICAgICAgdGhpcy5wcm9jZXNzID0gYXdhaXQgdGhpcy51aUF1dG9tYXRvci5zdGFydChcbiAgICAgICAgICAgICAgICAgICAgICAgYm9vdHN0cmFwSmFyLCAnaW8uYXBwaXVtLmFuZHJvaWQuYm9vdHN0cmFwLkJvb3RzdHJhcCcsXG4gICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0RGV0ZWN0b3IsICctZScsICdwa2cnLCBhcHBQYWNrYWdlLFxuICAgICAgICAgICAgICAgICAgICAgICAnLWUnLCAnZGlzYWJsZUFuZHJvaWRXYXRjaGVycycsIGRpc2FibGVBbmRyb2lkV2F0Y2hlcnMsXG4gICAgICAgICAgICAgICAgICAgICAgICctZScsICdhY2NlcHRTc2xDZXJ0cycsIGFjY2VwdFNzbENlcnRzKTtcblxuICAgICAgLy8gcHJvY2VzcyB0aGUgb3V0cHV0XG4gICAgICB0aGlzLnByb2Nlc3Mub24oJ291dHB1dCcsIChzdGRvdXQsIHN0ZGVycikgPT4ge1xuICAgICAgICBjb25zdCBhbGVydFJlID0gL0VtaXR0aW5nIHN5c3RlbSBhbGVydCBtZXNzYWdlLztcbiAgICAgICAgaWYgKGFsZXJ0UmUudGVzdChzdGRvdXQpKSB7XG4gICAgICAgICAgbG9nLmRlYnVnKCdFbWl0dGluZyBhbGVydCBtZXNzYWdlLi4uJyk7XG4gICAgICAgICAgaWYgKHRoaXMud2ViU29ja2V0KSB7XG4gICAgICAgICAgICB0aGlzLndlYlNvY2tldC5zb2NrZXRzLmVtaXQoJ2FsZXJ0Jywge21lc3NhZ2U6IHN0ZG91dH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRoZSBib290c3RyYXAgbG9nZ2VyIHdyYXBzIGl0cyBvd24gbG9nIGxpbmVzIHdpdGhcbiAgICAgICAgLy8gW0FQUElVTS1VSUFVVE9dIC4uLiBbQVBQSVVNLVVJQVVUT11cbiAgICAgICAgLy8gYW5kIGxlYXZlcyBhY3R1YWwgVWlBdXRvbWF0b3IgbG9ncyBhcyB0aGV5IGFyZVxuICAgICAgICBsZXQgc3Rkb3V0TGluZXMgPSAoc3Rkb3V0IHx8ICcnKS5zcGxpdCgnXFxuJyk7XG4gICAgICAgIGNvbnN0IHVpYXV0b0xvZyA9IC9cXFtBUFBJVU0tVUlBVVRPXFxdKC4rKVxcW1xcL0FQUElVTS1VSUFVVE9cXF0vO1xuICAgICAgICBmb3IgKGxldCBsaW5lIG9mIHN0ZG91dExpbmVzKSB7XG4gICAgICAgICAgaWYgKGxpbmUudHJpbSgpKSB7XG4gICAgICAgICAgICBpZiAodWlhdXRvTG9nLnRlc3QobGluZSkpIHtcbiAgICAgICAgICAgICAgbGV0IGlubmVyTGluZSA9IHVpYXV0b0xvZy5leGVjKGxpbmUpWzFdLnRyaW0oKTtcbiAgICAgICAgICAgICAgbGV0IGxvZ01ldGhvZCA9IGxvZy5pbmZvLmJpbmQobG9nKTtcbiAgICAgICAgICAgICAgLy8gaWYgdGhlIGJvb3RzdHJhcCBsb2cgY29uc2lkZXJzIHNvbWV0aGluZyBkZWJ1ZywgbG9nIHRoYXQgYXNcbiAgICAgICAgICAgICAgLy8gZGVidWcgYW5kIG5vdCBpbmZvXG4gICAgICAgICAgICAgIGlmICgvXFxbZGVidWdcXF0vLnRlc3QoaW5uZXJMaW5lKSkge1xuICAgICAgICAgICAgICAgIGxvZ01ldGhvZCA9IGxvZy5kZWJ1Zy5iaW5kKGxvZyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgbG9nTWV0aG9kKGBbQk9PVFNUUkFQIExPR10gJHtpbm5lckxpbmV9YCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBsb2cuZGVidWcoYFtVSUFVVE8gU1RET1VUXSAke2xpbmV9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHN0ZGVyckxpbmVzID0gKHN0ZGVyciB8fCAnJykuc3BsaXQoJ1xcbicpO1xuICAgICAgICBmb3IgKGxldCBsaW5lIG9mIHN0ZGVyckxpbmVzKSB7XG4gICAgICAgICAgaWYgKGxpbmUudHJpbSgpKSB7XG4gICAgICAgICAgICBsb2cuZGVidWcoYFtVSUFVVE8gU1RERVJSXSAke2xpbmV9YCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgLy8gb25seSByZXR1cm4gd2hlbiB0aGUgc29ja2V0IGNsaWVudCBoYXMgY29ubmVjdGVkXG4gICAgICByZXR1cm4gYXdhaXQgbmV3IEIoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHRoaXMuc29ja2V0Q2xpZW50ID0gbmV0LmNvbm5lY3QodGhpcy5zeXN0ZW1Qb3J0KTtcbiAgICAgICAgICAvLyBXaW5kb3dzOiB0aGUgc29ja2V0IGVycm9ycyBvdXQgd2hlbiBBREIgcmVzdGFydHMuIExldCdzIGNhdGNoIGl0IHRvIGF2b2lkIGNyYXNoaW5nLlxuICAgICAgICAgIHRoaXMuc29ja2V0Q2xpZW50Lm9uKCdlcnJvcicsIChlcnIpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pZ25vcmVVbmV4cGVjdGVkU2h1dGRvd24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBBbmRyb2lkIGJvb3RzdHJhcCBzb2NrZXQgY3Jhc2hlZDogJHtlcnJ9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdGhpcy5zb2NrZXRDbGllbnQub25jZSgnY29ubmVjdCcsICgpID0+IHtcbiAgICAgICAgICAgIGxvZy5pbmZvKCdBbmRyb2lkIGJvb3RzdHJhcCBzb2NrZXQgaXMgbm93IGNvbm5lY3RlZCcpO1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgRXJyb3Igb2NjdXJlZCB3aGlsZSBzdGFydGluZyBBbmRyb2lkQm9vdHN0cmFwLiBPcmlnaW5hbCBlcnJvcjogJHtlcnJ9YCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2VuZENvbW1hbmQgKHR5cGUsIGV4dHJhID0ge30pIHtcbiAgICBpZiAoIXRoaXMuc29ja2V0Q2xpZW50KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NvY2tldCBjb25uZWN0aW9uIGNsb3NlZCB1bmV4cGVjdGVkbHknKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYXdhaXQgbmV3IEIoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgbGV0IGNtZCA9IE9iamVjdC5hc3NpZ24oe2NtZDogdHlwZX0sIGV4dHJhKTtcbiAgICAgIGxldCBjbWRKc29uID0gYCR7SlNPTi5zdHJpbmdpZnkoY21kKX0gXFxuYDtcbiAgICAgIGxvZy5kZWJ1ZyhgU2VuZGluZyBjb21tYW5kIHRvIGFuZHJvaWQ6ICR7Xy50cnVuY2F0ZShjbWRKc29uLCB7bGVuZ3RoOiAxMDAwfSkudHJpbSgpfWApO1xuICAgICAgdGhpcy5zb2NrZXRDbGllbnQud3JpdGUoY21kSnNvbik7XG4gICAgICB0aGlzLnNvY2tldENsaWVudC5zZXRFbmNvZGluZygndXRmOCcpO1xuICAgICAgbGV0IHN0cmVhbURhdGEgPSAnJztcbiAgICAgIGxldCBzZW5kQ29tbWFuZFRpbWVvdXRIYW5kbGVyID0gbnVsbDtcbiAgICAgIHRoaXMuc29ja2V0Q2xpZW50Lm9uKCdkYXRhJywgKGRhdGEpID0+IHtcbiAgICAgICAgaWYgKHNlbmRDb21tYW5kVGltZW91dEhhbmRsZXIpIHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQoc2VuZENvbW1hbmRUaW1lb3V0SGFuZGxlcik7XG4gICAgICAgIH1cbiAgICAgICAgbG9nLmRlYnVnKCdSZWNlaXZlZCBjb21tYW5kIHJlc3VsdCBmcm9tIGJvb3RzdHJhcCcpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHN0cmVhbURhdGEgPSBKU09OLnBhcnNlKHN0cmVhbURhdGEgKyBkYXRhKTtcbiAgICAgICAgICAvLyB3ZSBzdWNjZXNzZnVsbHkgcGFyc2VkIEpTT04gc28gd2UndmUgZ290IGFsbCB0aGUgZGF0YSxcbiAgICAgICAgICAvLyByZW1vdmUgdGhlIHNvY2tldCBsaXN0ZW5lciBhbmQgZXZhbHVhdGVcbiAgICAgICAgICB0aGlzLnNvY2tldENsaWVudC5yZW1vdmVBbGxMaXN0ZW5lcnMoJ2RhdGEnKTtcbiAgICAgICAgICBpZiAoc3RyZWFtRGF0YS5zdGF0dXMgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHN0cmVhbURhdGEudmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZWplY3QoZXJyb3JGcm9tQ29kZShzdHJlYW1EYXRhLnN0YXR1cywgc3RyZWFtRGF0YS52YWx1ZSkpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBpZiAoIV8uaXNTdHJpbmcoc3RyZWFtRGF0YSkpIHtcbiAgICAgICAgICAgIGxvZy5lcnJvcignR290IGFuIHVuZXhwZWN0ZWQgZXJyb3IgaW5zaWRlIHNvY2tldCBsaXN0ZW5lcicpO1xuICAgICAgICAgICAgbG9nLmVycm9yKGVyci5zdGFjayk7XG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycm9yRnJvbUNvZGUoMTMsIGVyci5tZXNzYWdlKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGxvZy5kZWJ1ZyhgU3RyZWFtIHN0aWxsIG5vdCBjb21wbGV0ZSwgd2FpdGluZyB1cCB0byAke1NFTkRfQ09NTUFORF9USU1FT1VUfW1zIGZvciB0aGUgZGF0YSB0byBhcnJpdmVgKTtcbiAgICAgICAgICBzdHJlYW1EYXRhICs9IGRhdGE7XG4gICAgICAgICAgc2VuZENvbW1hbmRUaW1lb3V0SGFuZGxlciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyTXNnID0gYFNlcnZlciBzb2NrZXQgc3RvcHBlZCByZXNwb25kaW5nLiBUaGUgcmVjZW50IHJlc3BvbnNlIHdhcyAnJHtzdHJlYW1EYXRhfSdgO1xuICAgICAgICAgICAgbG9nLmVycm9yKGVyck1zZyk7XG4gICAgICAgICAgICB0aGlzLnNvY2tldENsaWVudC5yZW1vdmVBbGxMaXN0ZW5lcnMoJ2RhdGEnKTtcbiAgICAgICAgICAgIHJlamVjdChlcnJvckZyb21Db2RlKDEzLCBlcnJNc2cpKTtcbiAgICAgICAgICB9LCBTRU5EX0NPTU1BTkRfVElNRU9VVCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgc2VuZEFjdGlvbiAoYWN0aW9uLCBwYXJhbXMgPSB7fSkge1xuICAgIGxldCBleHRyYSA9IHthY3Rpb24sIHBhcmFtc307XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuc2VuZENvbW1hbmQoQ09NTUFORF9UWVBFUy5BQ1RJT04sIGV4dHJhKTtcbiAgfVxuXG4gIGFzeW5jIHNodXRkb3duICgpIHtcbiAgICBpZiAoIXRoaXMudWlBdXRvbWF0b3IpIHtcbiAgICAgIGxvZy53YXJuKCdDYW5ub3Qgc2h1dCBkb3duIEFuZHJvaWQgYm9vdHN0cmFwOyBpdCBoYXMgYWxyZWFkeSBzaHV0IGRvd24nKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyByZW1vdmUgbGlzdG5lcnMgc28gd2UgZG9uJ3QgdHJpZ2dlciB1bmV4cGVjdGVkIHNodXRkb3duXG4gICAgdGhpcy51aUF1dG9tYXRvci5yZW1vdmVBbGxMaXN0ZW5lcnMoVWlBdXRvbWF0b3IuRVZFTlRfQ0hBTkdFRCk7XG4gICAgaWYgKHRoaXMuc29ja2V0Q2xpZW50KSB7XG4gICAgICBhd2FpdCB0aGlzLnNlbmRDb21tYW5kKENPTU1BTkRfVFlQRVMuU0hVVERPV04pO1xuICAgIH1cbiAgICBhd2FpdCB0aGlzLnVpQXV0b21hdG9yLnNodXRkb3duKCk7XG4gICAgdGhpcy51aUF1dG9tYXRvciA9IG51bGw7XG4gIH1cblxuICAvLyB0aGlzIGhlbHBlciBmdW5jdGlvbiBtYWtlcyB1bml0IHRlc3RpbmcgZWFzaWVyLlxuICBhc3luYyBpbml0ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhpcy51aUF1dG9tYXRvciA9IG5ldyBVaUF1dG9tYXRvcih0aGlzLmFkYik7XG5cbiAgICAvLyBIYW5kbGUgdW5leHBlY3RlZCBVaUF1dG9tYXRvciBzaHV0ZG93blxuICAgIHRoaXMudWlBdXRvbWF0b3Iub24oVWlBdXRvbWF0b3IuRVZFTlRfQ0hBTkdFRCwgKG1zZykgPT4ge1xuICAgICAgaWYgKG1zZy5zdGF0ZSA9PT0gVWlBdXRvbWF0b3IuU1RBVEVfU1RPUFBFRCkge1xuICAgICAgICB0aGlzLnVpQXV0b21hdG9yID0gbnVsbDtcbiAgICAgICAgdGhpcy5vblVuZXhwZWN0ZWRTaHV0ZG93bi5jYW5jZWwobmV3IEVycm9yKCdVaUFVdG9tYXRvciBzaHV0IGRvd24gdW5leHBlY3RlZGx5JykpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgc2V0IGlnbm9yZVVuZXhwZWN0ZWRTaHV0ZG93biAoaWdub3JlKSB7XG4gICAgbG9nLmRlYnVnKGAke2lnbm9yZSA/ICdJZ25vcmluZycgOiAnV2F0Y2hpbmcgZm9yJ30gYm9vdHN0cmFwIGRpc2Nvbm5lY3RgKTtcbiAgICB0aGlzLl9pZ25vcmVVbmV4cGVjdGVkU2h1dGRvd24gPSBpZ25vcmU7XG4gIH1cblxuICBnZXQgaWdub3JlVW5leHBlY3RlZFNodXRkb3duICgpIHtcbiAgICByZXR1cm4gdGhpcy5faWdub3JlVW5leHBlY3RlZFNodXRkb3duO1xuICB9XG59XG5cbmV4cG9ydCB7IEFuZHJvaWRCb290c3RyYXAsIENPTU1BTkRfVFlQRVMgfTtcbmV4cG9ydCBkZWZhdWx0IEFuZHJvaWRCb290c3RyYXA7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsR0FBRyxHQUFHQyxlQUFBLENBQU9DLFNBQVAsQ0FBaUIsa0JBQWpCLENBQVo7O0FBQ0EsTUFBTUMsYUFBYSxHQUFHO0VBQ3BCQyxNQUFNLEVBQUUsUUFEWTtFQUVwQkMsUUFBUSxFQUFFO0FBRlUsQ0FB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
